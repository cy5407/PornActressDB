# ğŸ¯ æ—¥æ–‡ç¶²ç«™æœå°‹åŠŸèƒ½ä¿®æ­£æŒ‡å—

## ğŸ“‹ å•é¡Œè¨ºæ–·çµæœ

### ğŸ” æ ¹æœ¬åŸå› 
1. **Brotli å£“ç¸®å•é¡Œ**ï¼šæ—¥æ–‡ç¶²ç«™ä½¿ç”¨ `content-encoding: br`ï¼ˆBrotli å£“ç¸®ï¼‰
2. **httpx è‡ªå‹•è§£å£“å¤±æ•—**ï¼šhttpx åœ¨è™•ç† Brotli å£“ç¸®æ™‚å‡ºç¾å•é¡Œ
3. **ç·¨ç¢¼æª¢æ¸¬å¤±æ•ˆ**ï¼šç”±æ–¼è§£å£“å•é¡Œï¼Œæ‰€æœ‰ç·¨ç¢¼æª¢æ¸¬éƒ½å¤±æ•—

### âœ… è§£æ±ºæ–¹æ¡ˆ
**é—œéµç™¼ç¾**ï¼šç¦ç”¨ `Accept-Encoding` æ¨™é ­å¾Œï¼Œç¶²ç«™æœƒå›å‚³æœªå£“ç¸®çš„ HTMLï¼Œä¸”èƒ½æ‰¾åˆ° `actress-name` å…ƒç´ ï¼

## ğŸ› ï¸ éœ€è¦ä¿®æ­£çš„æª”æ¡ˆ

### 1. `web_searcher.py`
**å•é¡Œ**ï¼šä½¿ç”¨äº†æœƒè§¸ç™¼ Brotli å£“ç¸®çš„æ¨™é ­
**ä¿®æ­£**ï¼šç§»é™¤æˆ–ä¿®æ”¹ `Accept-Encoding` æ¨™é ­

### 2. `japanese_site_enhancer.py` 
**å•é¡Œ**ï¼šç·¨ç¢¼æª¢æ¸¬é‚è¼¯è¤‡é›œä½†ç„¡æ•ˆ
**ä¿®æ­£**ï¼šç°¡åŒ–é‚è¼¯ï¼Œå°ˆæ³¨æ–¼æœªå£“ç¸®å…§å®¹çš„è™•ç†

### 3. `classifier_core.py`
**ç‹€æ…‹**ï¼šåˆ†é›¢æœå°‹æ–¹æ³•éœ€è¦æ–°å¢
**ä¿®æ­£**ï¼šæ–°å¢ `process_and_search_japanese_sites` å’Œ `process_and_search_javdb` æ–¹æ³•

## ğŸ¯ å…·é«”ä¿®æ­£æ­¥é©Ÿ

### æ­¥é©Ÿ 1ï¼šä¿®æ­£ `web_searcher.py` çš„ HTTP æ¨™é ­
```python
# ç‚ºæ—¥æ–‡ç¶²ç«™ä½¿ç”¨ç‰¹æ®Šçš„æ¨™é ­é…ç½®
japanese_headers = {
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
    'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',
    'Accept-Language': 'ja,en-US;q=0.7,en;q=0.3',
    # é—œéµï¼šä¸åŒ…å« Accept-Encoding ä»¥é¿å… Brotli å£“ç¸®
    'Connection': 'keep-alive',
}
```

### æ­¥é©Ÿ 2ï¼šæ›´æ–°æ—¥æ–‡ç¶²ç«™æœå°‹æ–¹æ³•
```python
def make_japanese_request(url, **kwargs):
    with httpx.Client(timeout=self.timeout, **kwargs) as client:
        # ä½¿ç”¨ä¸æ”¯æ´å£“ç¸®çš„æ¨™é ­
        response = client.get(url, headers=self.japanese_headers)
        response.raise_for_status()
        return BeautifulSoup(response.text, 'html.parser')
```

### æ­¥é©Ÿ 3ï¼šæ–°å¢ `classifier_core.py` åˆ†é›¢æœå°‹æ–¹æ³•

### æ­¥é©Ÿ 4ï¼šæ¸¬è©¦å’Œé©—è­‰

## ğŸ“ å®Œæ•´ä¿®æ­£ç¨‹å¼ç¢¼

### A. ä¿®æ­£ `web_searcher.py`

éœ€è¦åœ¨ `__init__` æ–¹æ³•ä¸­æ–°å¢æ—¥æ–‡ç¶²ç«™å°ˆç”¨æ¨™é ­ï¼š
```python
# æ—¥æ–‡ç¶²ç«™å°ˆç”¨æ¨™é ­ï¼ˆé¿å… Brotli å£“ç¸®å•é¡Œï¼‰
self.japanese_headers = {
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
    'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',
    'Accept-Language': 'ja,en-US;q=0.7,en;q=0.3',
    # é—œéµï¼šä¸åŒ…å« Accept-Encoding ä»¥é¿å…å£“ç¸®
    'Connection': 'keep-alive',
    'Upgrade-Insecure-Requests': '1'
}
```

ä¿®æ­£ `_search_av_wiki` å’Œ `_search_chiba_f_net` æ–¹æ³•ï¼š
```python
def make_request(url, **kwargs):
    with httpx.Client(timeout=self.timeout, **kwargs) as client:
        # ä½¿ç”¨æ—¥æ–‡ç¶²ç«™å°ˆç”¨æ¨™é ­
        response = client.get(url, headers=self.japanese_headers)
        response.raise_for_status()
        return BeautifulSoup(response.text, 'html.parser')
```

### B. æ–°å¢ `classifier_core.py` åˆ†é›¢æœå°‹æ–¹æ³•

```python
def process_and_search_japanese_sites(self, folder_path: str, stop_event: threading.Event, progress_callback=None):
    \"\"\"åƒ…ä½¿ç”¨æ—¥æ–‡ç¶²ç«™æœå°‹ (AV-WIKI å’Œ chiba-f.net)\"\"\"
    # ä½¿ç”¨ self.web_searcher.search_japanese_sites ä½œç‚ºæœå°‹æ–¹æ³•
    
def process_and_search_javdb(self, folder_path: str, stop_event: threading.Event, progress_callback=None):
    \"\"\"åƒ…ä½¿ç”¨ JAVDB æœå°‹\"\"\"
    # ä½¿ç”¨ self.web_searcher.search_javdb_only ä½œç‚ºæœå°‹æ–¹æ³•
```

### C. ç¢ºä¿ GUI æŒ‰éˆ•æ­£ç¢ºç¶å®š

GUI ä¸­çš„æŒ‰éˆ•å·²ç¶“æ­£ç¢ºè¨­å®šï¼š
- ğŸ‡¯ğŸ‡µ æ—¥æ–‡ç¶²ç«™æœå°‹ â†’ `start_japanese_search()`
- ğŸ“Š JAVDB æœå°‹ â†’ `start_javdb_search()`

## ğŸ§ª æ¸¬è©¦è¨ˆåŠƒ

1. **å–®å…ƒæ¸¬è©¦**ï¼šæ¸¬è©¦å–®å€‹ç•ªè™Ÿçš„æ—¥æ–‡ç¶²ç«™æœå°‹
2. **æ•´åˆæ¸¬è©¦**ï¼šæ¸¬è©¦å®Œæ•´çš„åˆ†é›¢æœå°‹æµç¨‹
3. **GUI æ¸¬è©¦**ï¼šé©—è­‰å…©å€‹æŒ‰éˆ•åŠŸèƒ½æ­£å¸¸
4. **ç·¨ç¢¼æ¸¬è©¦**ï¼šç¢ºèªå¥³å„ªåç¨±æ­£ç¢ºé¡¯ç¤º

## ğŸ‰ é æœŸçµæœ

ä¿®æ­£å¾Œæ‡‰è©²èƒ½å¤ ï¼š
1. âœ… æ—¥æ–‡ç¶²ç«™æœå°‹æ‰¾åˆ°å¥³å„ªè³‡è¨Š
2. âœ… å¥³å„ªåç¨±æ­£ç¢ºé¡¯ç¤ºï¼ˆç„¡äº‚ç¢¼ï¼‰
3. âœ… GUI åˆ†é›¢æŒ‰éˆ•åŠŸèƒ½æ­£å¸¸
4. âœ… è³‡æ–™æ­£ç¢ºå¯«å…¥è³‡æ–™åº«

---

**ä¸‹ä¸€æ­¥**ï¼šè«‹å°‡æ­¤æŒ‡å—æä¾›çµ¦ Claude Code åŸ·è¡Œå®Œæ•´ä¿®æ­£ã€‚
