# 片商分類引擎「大片商例外」功能修正報告（2025-06-20）

## 1. 需求背景

- 當女優資料夾或女優名下影片不超過三部，且番號屬於「大片商」（定義：番號前綴至少三種，或為 E-BODY、FALENO）時，強制將女優分類到片商資料夾。
- 目標：提升分類準確度，避免小量作品女優被誤歸為單體企劃。

## 2. 功能邏輯

- **大片商定義**：番號前綴數量 >= 3，或片商為 E-BODY、FALENO。
- **例外規則**：女優影片數 ≤ 3 且屬於大片商時，分類推薦為片商，信心度自動提升至 70% 以上。
- **資料庫分析與檔案掃描皆支援此例外邏輯。**

## 3. 主要異動檔案

- `src/services/studio_classifier.py`
  - 新增 `_identify_major_studios`、`_is_major_studio` 方法
  - 修改 `_determine_main_studio`、`_update_actress_statistics`，支援大片商例外
  - 全面補上中文註釋
- `src/models/database.py`
  - `analyze_actress_primary_studio` 方法支援 major_studios 參數與例外推薦邏輯
  - 補上中文註釋

## 4. 測試與驗證

- 語法檢查：兩檔案均可正常導入與編譯
- 單元測試：
  - S1（6前綴）+ 2部 → 信心度100%，推薦片商
  - E-BODY（2前綴，特例）+ 1部 → 信心度100%，推薦片商
  - FALENO（3前綴，特例）+ 1部 → 信心度100%，推薦片商
  - MOODYZ（9前綴）+ 2部 → 信心度100%，推薦片商
- 功能驗證：例外條件下女優自動歸類片商資料夾

## 5. 影響評估

- 提升分類準確率，減少誤分類
- 兼容原有分類邏輯，無破壞性

## 6. 版本資訊

- 版本：v2.1.0
- 日期：2025-06-20
- 作者：GitHub Copilot

---

> 本次修正已全面補上中文註釋，若需進一步優化或有新需求，請隨時提出。
