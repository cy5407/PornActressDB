# 大片商優先分類邏輯修正報告

**建立日期**: 2025-06-22  
**修正問題**: 修正片商分類邏輯，確保只有9家大片商的女優才歸類到片商資料夾

## 🐛 問題描述

### 原有問題
系統將許多小片商的女優歸類到了具體的片商資料夾，例如：
- `SMALL_STUDIO`, `S_KYUU_SHIROTO`, `LULU`, `HOI_SERIES`, `MAAN`
- `OPPAI`, `AGAV`, `ROCKET`, `HALE`, `MANZOKU`, `MOMOTARO`
- `NAMH`, `ATTACKERS` 等

### 用戶需求
只有以下9家大片商的女優才能歸類到片商資料夾：
- **E-BODY**, **FALENO**, **S1**, **SOD**, **PRESTIGE**
- **MOODYZ**, **MADONNA**, **IdeaPocket**, **KAWAII**

其他所有片商的女優都應該歸類到「單體企劃女優」資料夾。

## 🔧 修正內容

### 1. 修正資料庫分析邏輯 (`database.py`)

**修正前**：基於信心度決定，信心度≥60%就歸類到片商資料夾
```python
elif confidence >= 60:
    # 基於信心度判斷，移除影片數量限制
    recommendation = 'studio_classification'
```

**修正後**：只有大片商才能歸類到片商資料夾
```python
elif major_studios and best_studio in major_studios:
    # 只有大片商且信心度足夠才分類到片商資料夾
    if confidence >= 50:
        recommendation = 'studio_classification'
    else:
        recommendation = 'solo_artist'
else:
    # 非大片商一律歸類為單體企劃，不管信心度多高
    recommendation = 'solo_artist'
```

### 2. 修正檔案掃描備援邏輯 (`studio_classifier.py`)

**修正前**：信心度≥60%就歸類到片商資料夾
```python
recommendation = 'studio_classification' if confidence >= 60 else 'solo_artist'
```

**修正後**：只有大片商才能歸類到片商資料夾
```python
if self._is_major_studio(main_studio):
    # 大片商：影片數少時強制推薦片商分類
    if len(video_files) <= 3:
        recommendation = 'studio_classification'
    elif confidence >= 50:
        recommendation = 'studio_classification'
    else:
        recommendation = 'solo_artist'
else:
    # 非大片商一律歸類為單體企劃
    recommendation = 'solo_artist'
```

## ✅ 測試驗證

執行 `test_major_studio_only.py` 測試結果：

```
✅ 大片商女優 - SOD：歸類到片商資料夾
✅ 小片商女優 - SMALL_STUDIO：歸類為單體企劃女優
✅ 小片商女優 - ATTACKERS：歸類為單體企劃女優
✅ 大片商低信心度 - MOODYZ：歸類為單體企劃女優
✅ 大片商少影片 - KAWAII：歸類到片商資料夾
```

## 🎯 新分類規則

### ✅ **歸類到片商資料夾的條件**
1. **必須是9家大片商之一**
2. **信心度≥50%** 或 **影片數≤3部**（大片商例外）

### 🎭 **歸類到單體企劃女優的條件**
1. **所有非大片商女優**（不管信心度多高）
2. **大片商女優但信心度<50%**（且影片數>3部）

### 📊 **影響的片商清單**

#### 🎯 **9家大片商**（可歸類到片商資料夾）
- E-BODY, FALENO, S1, SOD, PRESTIGE
- MOODYZ, MADONNA, IdeaPocket, KAWAII

#### 🎭 **其他片商**（一律歸類為單體企劃女優）
- SMALL_STUDIO, S_KYUU_SHIROTO, LULU, HOI_SERIES, MAAN
- OPPAI, AGAV, ROCKET, HALE, MANZOKU, MOMOTARO
- NAMH, ATTACKERS, 以及其他所有非指定大片商

## 📁 修改檔案

- `女優分類/src/models/database.py`
  - `analyze_actress_primary_studio` 函式：修正推薦分類邏輯
- `女優分類/src/services/studio_classifier.py`
  - `_update_actress_statistics` 函式：修正檔案掃描備援邏輯

## 💡 預期效果

1. **清潔的片商分類**：只有真正的大片商資料夾
2. **簡化的資料夾結構**：減少過多的小片商資料夾
3. **一致的分類標準**：基於用戶指定的9家大片商清單
4. **更好的管理體驗**：集中管理小片商和獨立女優

---

**✅ 修正完成**: 現在只有9家大片商的女優才會歸類到片商資料夾，其他都歸類為單體企劃女優。
